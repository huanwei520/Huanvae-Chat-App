# 测试框架说明

## 概述

Huanvae Chat App 使用 Vitest 作为测试框架，配合 Testing Library 进行 React 组件测试。

## 目录结构

```
tests/
├── setup.ts                     # 全局测试设置（Mock Tauri API）
├── checklist.ts                 # 功能检查清单定义
├── registry.ts                  # 组件注册表（118 个模块，含工具函数和共享组件）
├── README.md                    # 本文档
├── utils/
│   └── test-utils.tsx           # 测试工具函数
├── unit/                        # 单元测试
│   ├── update.test.ts           # 更新服务测试（含 Windows 安装类型检测）
│   ├── notification.test.ts     # 通知服务测试
│   ├── notificationSounds.test.ts # 提示音管理 Hook 测试
│   ├── settings.test.ts         # 设置状态管理测试（含大文件阈值）
│   ├── diagnosticService.test.ts # 诊断上报服务测试
│   ├── sessionLock.test.ts      # 会话锁服务测试（同账户单开，8 个用例）
│   ├── lanTransfer.test.ts      # 局域网传输测试
│   ├── devices.test.ts          # 设备管理 API 测试（8 个用例，含批量删除）
│   └── format.test.ts           # 格式化工具函数测试（12 个用例）
│   # 注：deviceInfo 服务测试需 Tauri 环境，在 registry.test.tsx 中验证导入
└── components/                  # 组件测试
    ├── LoadingSpinner.test.tsx  # 加载动画组件测试
    ├── SettingsPanel.test.tsx   # 设置面板组件测试（20 个测试用例）
    ├── UpdateToast.test.tsx     # 更新提示弹窗测试
    └── registry.test.tsx        # 组件注册表测试（109 个测试用例）
```

## 测试命令

```bash
# 运行测试（监听模式）
pnpm test

# 运行测试（单次）
pnpm test:run

# 运行测试并生成覆盖率报告
pnpm test:coverage

# 使用 UI 界面运行测试
pnpm test:ui

# TypeScript 类型检查
pnpm typecheck

# 运行所有检查（类型 + lint + 测试）
pnpm check
```

## 编写测试

### 单元测试示例

```typescript
// tests/unit/example.test.ts
import { describe, it, expect, vi } from 'vitest';
import { myFunction } from '../../src/utils/example';

describe('myFunction', () => {
  it('应该返回正确结果', () => {
    expect(myFunction(1, 2)).toBe(3);
  });

  it('处理边界情况', () => {
    expect(myFunction(0, 0)).toBe(0);
  });
});
```

### 组件测试示例

```typescript
// tests/components/Example.test.tsx
import { describe, it, expect } from 'vitest';
import { render, screen } from '../utils/test-utils';
import { MyComponent } from '../../src/components/MyComponent';

describe('MyComponent', () => {
  it('渲染正确的内容', () => {
    render(<MyComponent title="测试" />);
    expect(screen.getByText('测试')).toBeInTheDocument();
  });

  it('响应用户交互', async () => {
    const { user } = render(<MyComponent />);
    await user.click(screen.getByRole('button'));
    expect(screen.getByText('已点击')).toBeInTheDocument();
  });
});
```

## Mock 说明

`tests/setup.ts` 已预配置以下 Mock：

### Tauri API Mock

| 模块 | Mock 行为 |
|------|----------|
| `@tauri-apps/plugin-updater` | `check()` 返回 `null` |
| `@tauri-apps/plugin-process` | `relaunch()` 为空函数 |
| `@tauri-apps/plugin-notification` | 权限默认授予 |
| `@tauri-apps/plugin-fs` | 文件操作返回空 |
| `@tauri-apps/plugin-http` | `fetch()` 为空函数 |
| `@tauri-apps/plugin-os` | `platform()` 返回 `"linux"` |
| `@tauri-apps/plugin-window-state` | `restoreStateCurrent()` 返回 Promise |
| `@tauri-apps/api/window` | `getCurrentWindow()` 返回 mock 窗口对象 |
| `@tauri-apps/api/core` | `invoke()` 返回空函数（可按需 mock） |

### 浏览器 API Mock

- `localStorage` - 完整 mock
- `matchMedia` - 返回不匹配
- `ResizeObserver` - 空实现
- `IntersectionObserver` - 空实现

## 功能检查清单

`tests/checklist.ts` 定义了应用的所有功能点，用于预发布检查。

主要功能分类：
- 认证模块：登录/登出/自动登录
- 好友/群聊模块：消息发送、文件传输
- 文件模块：本地缓存、在文件夹中显示、大文件直连、**阈值设置**、**媒体预览窗口后台下载**
- 设置模块：提示音、数据管理、设备管理、更新检查、**主题配置（独立窗口、毛玻璃效果、高级透明度层级、跨窗口同步）**
- 局域网传输模块：设备发现、文件发送/接收、大文件传输
- 会议/媒体模块
- **Linux 安装与更新**：deb 包安装、用户数据目录、APT 仓库配置、apt upgrade 更新
- **移动端 (Android)**：见下方移动端测试清单

## 📱 移动端测试清单

### 安装依赖

移动端开发需要配置 Android SDK 和 NDK，参考 [Tauri 移动端文档](https://v2.tauri.app/guides/prerequisites/#android)。

### 运行移动端开发

```bash
# 连接 Android 设备后
unset CI && pnpm tauri android dev
```

### 测试项目

#### 认证模块

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 登录 | 输入账号密码，成功登录进入主界面 | ✅ |
| 密码保存 | 登录后弹出指纹验证，保存密码 | ✅ |
| 快速登录 | 杀后台重开，指纹验证后直接进入主界面 | ✅ |
| 登出 | 侧边栏登出，清除会话数据 | ✅ |

#### 界面布局

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 状态栏适配 | 顶部内容不被状态栏遮挡 | ✅ |
| 底部安全区域 | 输入栏有底部安全区域 padding | ✅ |
| 消息列表滚动 | 消息可上下滚动 | ✅ |
| 消息滚动到底部 | 进入聊天页面自动滚动到最新消息 | ✅ |

#### 手势导航

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 聊天页面返回 | 手势返回回到消息列表 | 待测试 |
| 模态框关闭 | 手势返回关闭设置/个人资料模态框 | 待测试 |
| 抽屉关闭 | 手势返回关闭侧边抽屉 | 待测试 |
| 主页面退出 | 主页面手势返回退出应用 | 待测试 |

#### 消息提示音

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 通知权限请求 | 启动时弹出权限请求 | 待测试 |
| 提示音试听 | 设置页面试听功能正常 | 待测试 |
| 新消息提示音 | 收到新消息时播放提示音 | 待测试 |

#### 会话持久化

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 登录后保存 | 登录成功后会话自动保存 | 待测试 |
| 后台被杀恢复 | 杀后台后重新打开自动恢复登录 | 待测试 |
| 无需生物验证 | 恢复过程无指纹/面容弹窗 | 待测试 |
| Token 过期处理 | Token 过期时跳转登录页 | 待测试 |
| 主动登出清除 | 登出后清除保存的会话 | 待测试 |

#### 启动速度

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 无白屏等待 | 启动后快速显示界面 | 待测试 |
| 跳过 window-state | 移动端不调用桌面端窗口插件 | 待测试 |
| 并行加载 | 数据库初始化和 Token 验证并行 | 待测试 |

#### 个人资料页面

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 页面打开 | 点击头像进入个人资料页面 | 待测试 |
| 毛玻璃效果 | 背景使用与抽屉一致的毛玻璃 | 待测试 |
| 头像上传 | 可上传新头像 | 待测试 |
| 昵称修改 | 可编辑昵称 | 待测试 |
| 返回手势 | 手势返回可关闭页面 | 待测试 |

#### 我的文件页面

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 页面打开 | 点击"我的文件"进入文件页面 | 待测试 |
| 文件列表 | 显示用户上传的文件 | 待测试 |
| 分类筛选 | 可切换总览/图片/视频/文件 | 待测试 |
| 文件搜索 | 可搜索文件名 | 待测试 |
| 媒体预览 | 点击图片/视频可预览 | 待测试 |
| 返回手势 | 手势返回可关闭页面 | 待测试 |

#### 局域网互传页面

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 页面打开 | 点击"局域网互传"进入页面 | 待测试 |
| 服务启动 | 进入页面后服务自动启动 | 待测试 |
| 设备发现 | 显示局域网内其他设备 | 待测试 |
| 文件发送 | 点击发送可选择文件（使用 tauri-plugin-android-fs） | 待测试 |
| content:// URI 处理 | Android 文件选择后能正确读取并发送 | 待测试 |
| 传输请求 | 收到请求时显示确认弹窗 | 待测试 |
| 传输进度 | 显示实时传输进度 | 待测试 |
| 返回手势 | 手势返回可关闭页面 | 待测试 |

#### 会话功能

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 好友消息列表 | 显示好友会话卡片 | ✅ |
| 群聊消息列表 | 显示群聊会话卡片 | ✅ |
| 发送消息 | 发送文字消息，自动滚动到底部 | ✅ |
| 接收消息 | 接收消息，在底部时自动滚动 | ✅ |
| 加载历史消息 | 上滑到顶部加载更多历史 | ✅ |

#### 聊天文件上传

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 好友聊天上传图片 | 点击附件按钮 → 选择图片 → 成功上传发送 | 待测试 |
| 好友聊天上传视频 | 点击附件按钮 → 选择视频 → 成功上传发送 | 待测试 |
| 好友聊天上传文件 | 点击附件按钮 → 选择文件 → 成功上传发送 | 待测试 |
| 群聊上传图片 | 点击附件按钮 → 选择图片 → 成功上传发送 | 待测试 |
| 群聊上传视频 | 点击附件按钮 → 选择视频 → 成功上传发送 | 待测试 |
| 群聊上传文件 | 点击附件按钮 → 选择文件 → 成功上传发送 | 待测试 |
| Android content:// 处理 | Android 文件选择返回 content:// URI 能正确处理 | 待测试 |
| 上传进度显示 | 上传过程中显示进度条 | 待测试 |
| 秒传功能 | 已上传过的文件秒传成功 | 待测试 |

#### 会话持久化

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 首次登录保存 | 登录成功后弹出一次指纹验证保存会话 | ✅ |
| 杀后台恢复 | 杀后台后重开，指纹验证恢复会话 | ✅ |
| Token 过期处理 | Token 过期时提示重新登录 | ✅ |

#### 媒体预览

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 图片点击预览 | 点击图片弹出全屏模态框预览 | 待测试 |
| 视频点击预览 | 点击视频弹出全屏模态框播放 | 待测试 |
| 预览关闭 | 点击关闭按钮或背景关闭预览 | 待测试 |
| 预览返回手势 | 预览打开时返回手势关闭预览，不退出聊天页面 | 待测试 |
| 视频缩略图 | 视频显示第一帧作为缩略图 | 待测试 |
| 本地视频播放 | 已缓存视频使用本地 HTTP 服务器播放 | 待测试 |
| 视频进度拖动 | 本地视频支持进度条拖动 | 待测试 |
| 在线视频播放 | 未缓存视频使用 presigned URL 在线播放 | 待测试 |
| 视频后台缓存 | 在线播放时后台下载到本地 | 待测试 |

#### 输入交互

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 进入聊天页面 | 不自动聚焦输入框，不弹出键盘 | 待测试 |
| 点击输入框 | 手动聚焦后弹出键盘 | 待测试 |
| 按 Enter 发送消息 | 发送后输入框保持聚焦，可继续输入 | 待测试 |
| 点击发送按钮 | 发送后焦点返回输入框，可继续输入 | 待测试 |

#### 群聊消息

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 自己发送的消息 | 显示在右侧，使用蓝色气泡 | 待测试 |
| 他人发送的消息 | 显示在左侧，使用灰色气泡 | 待测试 |

#### 视频会议入口页面

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 页面打开 | 点击"视频会议"进入入口页面 | 待测试 |
| 创建会议 | 填写信息后创建会议，显示房间信息 | 待测试 |
| 复制房间信息 | 点击复制按钮复制房间号和密码 | 待测试 |
| 进入创建的会议 | 点击"进入会议"进入会议页面 | 待测试 |
| 加入会议 | 输入房间号和密码加入会议 | 待测试 |
| 粘贴解析 | 粘贴包含房间信息的文本自动解析 | 待测试 |
| 返回手势 | 手势返回可关闭页面 | 待测试 |

#### 视频会议页面

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 权限请求 | 进入页面时请求摄像头和麦克风权限 | 待测试 |
| 本地视频 | 显示本地摄像头画面 | 待测试 |
| 摄像头开关 | 可开启/关闭摄像头 | 待测试 |
| 麦克风开关 | 可开启/关闭麦克风 | 待测试 |
| 参与者列表 | 显示会议中的参与者 | 待测试 |
| 离开会议 | 点击离开按钮退出会议 | 待测试 |
| 返回手势 | 手势返回可关闭页面 | 待测试 |
| 屏幕共享 | 移动端不支持屏幕共享，按钮隐藏 | 待测试 |

#### Android 自动更新

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 版本检测 | 启动后自动检查 android-latest.json | 待测试 |
| 代理切换 | 多个代理依次尝试，失败自动切换 | 待测试 |
| 更新弹窗 | 有新版本时显示灵动岛风格弹窗 | 待测试 |
| 下载进度 | 显示下载进度、已下载大小、代理信息 | 待测试 |
| APK 安装 | 下载完成后调用系统安装器 | 待测试 |
| 权限请求 | 首次安装时请求"安装未知应用"权限 | 待测试 |
| 稍后按钮 | 点击稍后关闭弹窗 | 待测试 |
| 重试功能 | 下载失败后可重试 | 待测试 |

### 已知限制

| 功能 | 限制说明 | 替代方案 |
|------|----------|----------|
| 视频会议屏幕共享 | Android WebView 不支持 getDisplayMedia | 隐藏屏幕共享按钮 |
| 主题编辑器 | 使用 WebviewWindow，移动端不可用 | 无 |
| 媒体预览窗口 | 使用 WebviewWindow，移动端不可用 | ✅ 使用全屏模态框替代 |
| 视频缩略图 | video 元素 preload 在移动端不可靠 | ✅ 使用本地服务器 + video 元素显示第一帧 |
| asset:// 视频 | Android WebView 不支持 asset:// 播放视频 | ✅ 使用本地 HTTP 服务器替代 |
| 桌面端更新器 | tauri-plugin-updater 不支持 Android | ✅ 使用自定义服务 + tauri-plugin-android-package-install |

### 更新日志

- 2026-01-22: 添加移动端会话持久化（生物识别 + keystore）
- 2026-01-22: 修复状态栏/底部安全区域适配
- 2026-01-22: 修复消息列表滚动到底部问题
- 2026-01-22: 添加移动端媒体全屏预览模态框
- 2026-01-22: 修复群聊消息气泡位置/颜色问题
- 2026-01-22: 禁用移动端输入框自动聚焦
- 2026-01-23: 添加移动端本地视频 HTTP 服务器（解决 asset:// 视频播放问题）
- 2026-01-23: 移动端视频缩略图改用 video 元素显示第一帧
- 2026-01-23: 添加移动端手势返回处理（tauri-plugin-mobile-onbackpressed-listener）
- 2026-01-23: 添加 Android 设备信息获取（使用 UUID 替代 MAC 地址）
- 2026-01-23: 移动端提示音播放改用本地 HTTP 服务器
- 2026-01-23: 移动端会话持久化改用 tauri-plugin-store（无需生物验证）
- 2026-01-23: 移动端启动速度优化
- 2026-01-23: 移动端个人资料和我的文件独立页面
- 2026-01-23: 移动端设置页面独立化、滑动切换、局域网互传页面
- 2026-01-23: 添加 tauri-plugin-android-fs 解决 Android content:// URI 文件读取问题
- 2026-01-23: 添加移动端视频会议入口页面和会议页面（使用 WebRTC，不支持屏幕共享）
- 2026-01-23: 添加 Android 自动更新功能（tauri-plugin-android-package-install）
  - 检测 android-latest.json 获取版本信息
- 2026-01-23: 修复 Android 聊天文件上传（好友/群聊）
  - FileAttachButton 添加 Android 平台检测
  - 使用 tauri-plugin-android-fs 处理 content:// URI
  - 与局域网传输共用 selectFilesForTransfer 函数
  - 多代理自动切换下载
  - 灵动岛风格更新弹窗（与桌面端 UI 一致）
  - APK 下载完成后调用系统安装器
- 2026-01-23: 优化聊天输入框聚焦行为
  - 点击发送按钮后焦点自动返回输入框，无需重新点击
- 2026-01-23: 移动端媒体预览返回手势优化
  - 预览打开时返回手势关闭预览，不退出聊天页面
  - 使用 useMobileBackHandler 拦截返回事件
- 2026-01-23: 优化更新弹窗防抖与多实例问题
  - 引入全局 Zustand Store 统一管理更新状态
  - App.tsx 统一渲染 UpdateToast，防止多实例
  - 自动检查和手动检查更新均通过全局 Store 进行，避免并发
- 2026-01-23: 移动端下载进度卡片嵌入消息列表
  - 下载状态时在消息列表顶部显示进度卡片
  - 与消息卡片同级，不遮挡操作，可被侧边栏遮挡
- 2026-01-23: 统一消息卡片毛玻璃样式
  - 桌面端和手机端消息卡片统一使用毛玻璃效果
  - 使用主题变量（--white-alpha-*、--blur-xs）接入设置颜色管理
  - 圆角、边框、阴影样式统一
- 2026-01-23: 桌面端选中边框改用蓝色线条
  - 移除选中背景渐变，使用透明背景 + 蓝色边框
  - 边框在卡片外围显示，圆角完美契合
- 2026-01-23: 消息右键菜单添加复制功能
  - 桌面端右键/移动端长按触发菜单
  - 文本消息显示"复制"选项
  - 私聊和群聊消息气泡统一支持
- 2026-01-23: 消息卡片透明度接入主题管理
  - 添加 --card-bg-* 系列变量
  - 透明度与更新弹窗一致（约 10-15%）
- 2026-01-23: 移动端双击全屏消息预览
  - 双击文本消息显示全屏预览
  - 毛玻璃背景，大字体易读
  - 底部复制按钮，返回手势关闭
  - 仅移动端生效，私聊和群聊统一支持
- 2026-01-23: 移动端会议悬浮图标功能
  - 会议进行中可最小化为圆形悬浮图标
  - 绿色脉冲指示器表示会议进行中
  - 可拖拽移动位置，点击恢复全屏
  - 长按显示操作菜单（返回会议/结束会议）
  - 最小化后可继续查看消息、聊天等页面
  - WebRTC 连接在 MobileMain 层级维护，最小化时保持连接
  - 悬浮图标显示参与者数量徽章
- 2026-01-24: 桌面端会议视频窗口布局修复
  - 使用 CSS Grid 替代 Flexbox 布局
  - 所有参与者视频窗口大小一致
  - 自适应列数，最大宽度 600px（单人时 900px）
- 2026-01-24: 移动端消息长按菜单优化
  - 菜单显示在气泡上方（微信风格）
  - 水平排列的菜单项
  - 新增"选取"选项（移动端专属）
  - 点击"选取"打开全屏预览页面，可自由选择文字复制
  - 触摸其他地方自动关闭菜单（菜单互斥）
- 2026-01-24: 移动端局域网链接按钮样式统一
  - 圆形蓝底白字样式与桌面端一致
- 2026-01-24: Windows NSIS 安装器更新流程优化
  - 精确终止 WebView2 子进程（使用 WMIC/PowerShell）
  - 更新前运行旧版卸载程序（静默模式）
  - 解决文件被占用导致更新失败的问题
  - 保持安装路径一致
- 2026-01-24: 局域网传输连接去重机制
  - 前端：requestPeerConnection 调用前检查 activeConnections
  - 后端：request_peer_connection 和 server 端都有去重检查
  - 已存在连接时返回现有 connectionId，防止重复连接
  - 已存在待处理请求时返回现有请求 ID，防止重复请求
- 2026-01-24: 局域网传输断开连接功能
  - 桌面端和移动端设备卡片添加断开连接按钮
  - 已连接设备显示：发送文件按钮 + 断开连接按钮
  - 应用退出/服务停止时自动断开所有活跃连接
  - 清空待处理的连接请求
- 2026-01-24: 局域网传输连接流程重构
  - 发起方不再预先保存连接（只在收到接受响应后才创建连接）
  - 拒绝后发送 PeerConnectionClosed 事件通知前端
  - 修复拒绝后无法重新申请连接的问题
  - 修复发起连接时对方没有收到请求提示的问题
  - 连接建立后自动清理来自该设备的待处理请求（解决互相请求时的重复显示问题）
- 2026-01-24: 桌面端局域网传输 UI 优化
  - 删除独立的"已建立的连接"模块
  - 已连接状态通过设备卡片上的绿色按钮+断开连接按钮显示
  - 与移动端逻辑保持一致
- 2026-01-24: mDNS 设备下线检测机制修复
  - 修复 fullname 格式不匹配问题：mDNS instance_name 限制为 15 字符，device_id 为 32 字符 UUID
  - 添加 fullname 到 device_id 的映射表，正确处理 ServiceRemoved 事件
  - 添加验证失败计数器，连续失败 3 次后主动移除设备
  - 验证任务使用正确的 fullname 进行 mDNS verify() 调用
  - 设备发现时保存映射，离线时清理映射和计数器
- 2026-01-24: 移动端消息气泡宽度优化（微信风格）
  - 移动端 max-width 从 70% 扩展到 calc(100% - 52px)
  - 消息可延伸到对侧，只保留一个头像位置的距离
  - 桌面端保持原有 70% 宽度不变
- 2026-01-24: Windows 安装类型检测（MSI/NSIS 更新包区分）
  - 后端添加 get_windows_installer_type 命令，通过注册表检测安装类型
  - 前端 checkForUpdates 根据安装类型自动选择正确的更新包
  - MSI 安装用户使用 target: "windows-x86_64-msi"
  - NSIS 安装用户使用默认 target
  - 参考文档: https://v2.tauri.app/plugin/updater/#custom-target
  - 解决 MSI 安装用户被更新成 EXE 包的问题
- 2026-01-24: 前端代码优化（重复代码提取）
  - 创建 `src/utils/format.ts` 统一格式化函数（formatSize/formatSpeed/formatEta）
  - 替换 LanTransferPage、MobileLanTransferPage、update/service 中的重复实现
  - 创建 `src/chat/shared/animations.ts` 统一消息动画配置
  - 创建 `src/chat/shared/SendStatusIndicator.tsx` 发送状态指示器组件
  - 减少约 200 行重复代码，提高可维护性
  - 参考文档: Vite tree-shaking、Atlassian barrel files 研究
- 2026-01-25: 局域网传输哈希算法从 SHA-256 迁移到 CRC32fast
  - 性能提升: ~7.3 GB/s（比 SHA-256 快约 14 倍）
  - TB 级文件传输预处理时间大幅缩短
  - 跨平台支持: Android AOSP 官方认证、Windows、macOS、Linux、iOS
  - 流式处理: 无需将整个文件读入内存
  - 协议字段名保持不变（sha256）以兼容现有版本
  - 参考文档: https://docs.rs/crc32fast/, https://android.googlesource.com/platform/external/rust/crates/crc32fast/

```typescript
import { FEATURE_CHECKLIST, getCriticalFeatures } from './checklist';

// 获取所有核心功能
const criticalFeatures = getCriticalFeatures();
console.log(`核心功能: ${criticalFeatures.length} 项`);
```

## 覆盖率目标

| 指标 | 最低要求 |
|------|---------|
| Statements | 30% |
| Branches | 30% |
| Functions | 30% |
| Lines | 30% |

随着测试完善，建议逐步提高覆盖率阈值。

## 预发布检查流程

1. 运行自动化检查：
   ```bash
   pnpm check
   ```

2. 运行预发布检查脚本（包含人工确认）：
   ```bash
   powershell -ExecutionPolicy Bypass -File .\scripts\pre-release.ps1
   ```

3. 确认所有检查通过后，执行发布：
   ```bash
   powershell -ExecutionPolicy Bypass -File .\scripts\release.ps1
   ```

